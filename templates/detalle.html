{% extends "base.html" %}

{% block content %}
<div class="card shadow">
    <div class="card-header d-flex justify-content-between align-items-center
        {% if incidente.severidad == 'critica' %}bg-danger text-white
        {% elif incidente.severidad == 'alta' %}bg-warning
        {% elif incidente.severidad == 'media' %}bg-primary text-white
        {% else %}bg-secondary text-white{% endif %}">
        <div>
            <h4 class="mb-0">
                <i class="bi bi-clipboard-check"></i>
                Incidente #{{ incidente.id }}: {{ incidente.titulo }}
            </h4>
        </div>
        <div class="badge bg-light text-dark">
            {{ incidente.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}
        </div>
    </div>
    
    <div class="card-body">
        <div class="row mb-4">
            <div class="col-md-3">
                <strong>Tipo:</strong><br>
                <span class="badge bg-info fs-6">{{ incidente.tipo }}</span>
            </div>
            <div class="col-md-3">
                <strong>Severidad:</strong><br>
                {% if incidente.severidad == 'critica' %}
                <span class="badge bg-danger fs-6">Crítica</span>
                {% elif incidente.severidad == 'alta' %}
                <span class="badge bg-warning fs-6">Alta</span>
                {% elif incidente.severidad == 'media' %}
                <span class="badge bg-primary fs-6">Media</span>
                {% else %}
                <span class="badge bg-secondary fs-6">Baja</span>
                {% endif %}
            </div>
            <div class="col-md-3">
                <strong>Estado Actual:</strong><br>
                <span class="badge 
                    {% if incidente.estado == 'Abierto' %}bg-warning
                    {% elif incidente.estado == 'En Investigación' %}bg-info
                    {% elif incidente.estado == 'Resuelto' %}bg-success
                    {% else %}bg-secondary{% endif %} fs-6">
                    {{ incidente.estado }}
                </span>
            </div>
            <div class="col-md-3">
                <strong>Reportado por:</strong><br>
                {{ incidente.usuario_reporta }}
            </div>
        </div>
        
        <h5>Descripción:</h5>
        <div class="alert alert-light border p-3">
            {{ incidente.descripcion|replace('\n', '<br>')|safe }}
        </div>
        
        <!-- Cambiar Estado -->
        <div class="mt-4">
            <form method="post" action="/incidente/{{ incidente.id }}/cambiar-estado" 
                  class="d-flex align-items-center">
                <strong class="me-3">Cambiar Estado:</strong>
                <select name="estado" class="form-select w-auto me-2">
                    <option value="Abierto" {% if incidente.estado == 'Abierto' %}selected{% endif %}>
                        Abierto
                    </option>
                    <option value="En Investigación" {% if incidente.estado == 'En Investigación' %}selected{% endif %}>
                        En Investigación
                    </option>
                    <option value="Resuelto" {% if incidente.estado == 'Resuelto' %}selected{% endif %}>
                        Resuelto
                    </option>
                    <option value="Cerrado" {% if incidente.estado == 'Cerrado' %}selected{% endif %}>
                        Cerrado
                    </option>
                </select>
                <button type="submit" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-check-circle"></i> Actualizar
                </button>
            </form>
        </div>
        
        <div class="mt-4">
            <a href="/incidentes" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver a la lista
            </a>
        </div>
    </div>
</div>
{% endblock %}